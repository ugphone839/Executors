<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executor Admin Panel - Full Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg: #121212; --surface: #1e1e1e; --primary: #bb86fc;
            --secondary: #03dac6; --text: #e0e0e0; --danger: #cf6679; --success: #4caf50;
        }

        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }
        
        /* LOGIN SCREEN */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 9999;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
        .login-box { background: var(--surface); padding: 30px; border-radius: 10px; text-align: center; width: 300px; }
        .login-box input { width: 90%; padding: 10px; margin: 10px 0; background: #333; border: 1px solid #555; color: white; border-radius: 5px; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: black; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; margin-top: 10px; width: 100%; }
        
        /* HEADER */
        .header {
            background: var(--surface); padding: 15px; display: flex; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5); position: sticky; top: 0; z-index: 100;
        }
        .menu-btn { font-size: 24px; cursor: pointer; margin-right: 20px; }

        /* SIDEBAR */
        .sidebar {
            position: fixed; left: -260px; top: 60px; bottom: 0; width: 250px;
            background: #181818; transition: 0.3s; z-index: 99; padding-top: 20px;
            border-right: 1px solid #333;
        }
        .sidebar.active { left: 0; }
        .nav-group { padding: 10px 20px; font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 1px; }
        .nav-item {
            padding: 12px 20px; cursor: pointer; display: flex; align-items: center; transition: 0.2s;
        }
        .nav-item:hover, .nav-item.active { background: #2a2a2a; color: var(--primary); }
        .nav-item i { margin-right: 15px; width: 20px; text-align: center; }

        /* CONTENT */
        .main-content { padding: 20px; max-width: 800px; margin: 0 auto; transition: 0.3s; padding-bottom: 100px; }

        /* CARDS & FORMS */
        .card { background: var(--surface); border-radius: 10px; padding: 20px; margin-bottom: 20px; border: 1px solid #333; }
        .card-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: var(--secondary); display: flex; justify-content: space-between; align-items: center; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 13px; color: #aaa; }
        .form-control {
            width: 100%; padding: 12px; background: #2c2c2c; border: 1px solid #444;
            color: white; border-radius: 5px; box-sizing: border-box;
        }
        .form-control:focus { outline: none; border-color: var(--primary); }

        /* DELETE LIST */
        .delete-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px; border-bottom: 1px solid #333;
        }
        .delete-item:last-child { border-bottom: none; }

        /* FAB SAVE */
        .fab-save {
            position: fixed; bottom: 30px; right: 30px;
            background: var(--success); color: white; width: 60px; height: 60px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            cursor: pointer; z-index: 200; transition: 0.3s;
        }
        .fab-save:hover { transform: scale(1.1); }
        .loading-spin { animation: spin 1s infinite linear; }
        @keyframes spin { from {transform:rotate(0deg)} to {transform:rotate(360deg)} }

        .tag { font-size: 10px; padding: 2px 6px; border-radius: 4px; background: #444; margin-left: 10px; vertical-align: middle; }

        #app { display: none; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2>üîê Admin Panel</h2>
            <input type="password" id="password-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
            <button class="btn btn-primary" onclick="attemptLogin()" style="width: 100%;">V√†o H·ªá Th·ªëng</button>
        </div>
    </div>

    <div id="app">
        <div class="header">
            <i class="fas fa-bars menu-btn" onclick="toggleSidebar()"></i>
            <div class="title" id="page-title">Ch·ªânh s·ª≠a: PC</div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="nav-group">Ch·ªânh s·ª≠a</div>
            <div class="nav-item active" onclick="switchView('edit', 'pc')"><i class="fas fa-desktop"></i> PC</div>
            <div class="nav-item" onclick="switchView('edit', 'android')"><i class="fab fa-android"></i> Android</div>
            <div class="nav-item" onclick="switchView('edit', 'ios')"><i class="fab fa-apple"></i> iOS</div>
            
            <div class="nav-group">Qu·∫£n l√Ω</div>
            <div class="nav-item" onclick="switchView('add')"><i class="fas fa-plus-circle"></i> Th√™m Executor</div>
            <div class="nav-item" onclick="switchView('delete')"><i class="fas fa-trash-alt"></i> X√≥a Executor</div>
        </div>

        <div class="main-content" id="content-area"></div>

        <div class="fab-save" id="save-btn" onclick="saveToGithub()" title="Ho√†n th√†nh & L∆∞u l√™n GitHub">
            <i class="fas fa-check"></i>
        </div>
    </div>

    <script>
        let DATA = null;
        let PASSWORD = "";
        let CURRENT_PLATFORM = 'pc';
        let CURRENT_VIEW = 'edit'; // edit, add, delete

        function attemptLogin() {
            PASSWORD = document.getElementById('password-input').value;
            if(!PASSWORD) return;
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            loadData();
        }

        async function loadData() {
            try {
                const res = await fetch('https://raw.githubusercontent.com/ugphone839/Executors/refs/heads/main/script.js?t=' + Date.now());
                const text = await res.text();
                const match = text.match(/const EXECUTOR_DATA = ({[\s\S]*?});/);
                if (match) {
                    DATA = eval('(' + match[1] + ')');
                    render();
                }
            } catch (e) { alert("L·ªói t·∫£i data: " + e.message); }
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

        function switchView(view, platform = null) {
            CURRENT_VIEW = view;
            if(platform) CURRENT_PLATFORM = platform;
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Logic highlight item menu... (ƒë∆°n gi·∫£n h√≥a)
            
            toggleSidebar();
            render();
        }

        function render() {
            const area = document.getElementById('content-area');
            const title = document.getElementById('page-title');
            area.innerHTML = "";

            if (CURRENT_VIEW === 'edit') {
                title.innerText = "Ch·ªânh s·ª≠a: " + CURRENT_PLATFORM.toUpperCase();
                renderEditView(area);
            } else if (CURRENT_VIEW === 'add') {
                title.innerText = "‚ûï Th√™m Executor M·ªõi";
                renderAddView(area);
            } else if (CURRENT_VIEW === 'delete') {
                title.innerText = "üóëÔ∏è X√≥a Executor";
                renderDeleteView(area);
            }
        }

        // --- VIEW: CH·ªàNH S·ª¨A ---
        function renderEditView(container) {
            DATA[CURRENT_PLATFORM].forEach((exe, idx) => {
                const isDual = exe.links.length > 1;
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-title">${exe.name} <span class="tag">${isDual?'Dual':'Single'}</span></div>
                    <div class="form-group">
                        <label>Version:</label>
                        <input type="text" class="form-control" value="${exe.version}" oninput="DATA['${CURRENT_PLATFORM}'][${idx}].version = this.value">
                    </div>
                    <div class="form-group">
                        <label>Status:</label>
                        <select class="form-control" onchange="updateStatusLogic('${CURRENT_PLATFORM}', ${idx}, this.value, ${isDual})">
                            ${renderStatusOptions(exe.status, isDual)}
                        </select>
                    </div>
                    ${isDual ? `
                        <div class="form-group"><label>Link Global:</label><input type="text" class="form-control" value="${exe.links[0].url}" oninput="DATA['${CURRENT_PLATFORM}'][${idx}].links[0].url = this.value"></div>
                        <div class="form-group"><label>Link VNG:</label><input type="text" class="form-control" value="${exe.links[1].url}" oninput="DATA['${CURRENT_PLATFORM}'][${idx}].links[1].url = this.value"></div>
                    ` : `
                        <div class="form-group"><label>Link T·∫£i:</label><input type="text" class="form-control" value="${exe.links[0].url}" oninput="DATA['${CURRENT_PLATFORM}'][${idx}].links[0].url = this.value"></div>
                    `}
                `;
                container.appendChild(card);
            });
        }

        function renderStatusOptions(current, isDual) {
            if(!isDual) {
                return `<option value="Online" ${current=='Online'?'selected':''}>üü¢ Online</option>
                        <option value="Offline" ${current=='Offline'?'selected':''}>üî¥ Offline</option>`;
            }
            return `<option value="Online" ${current=='Online'?'selected':''}>üü¢ C·∫£ 2 Online</option>
                    <option value="Offline" ${current=='Offline'?'selected':''}>üî¥ C·∫£ 2 Offline</option>
                    <option value="Partial_GOn" ${current=='Partial'?'selected':''}>üü° Global On / VNG Off</option>
                    <option value="Partial_VOn" ${current=='Partial'?'selected':''}>üü° Global Off / VNG On</option>`;
        }

        function updateStatusLogic(p, idx, val, isDual) {
            const exe = DATA[p][idx];
            if(!isDual) {
                exe.status = val;
                exe.links[0].statusText = "Status: " + val;
            } else {
                if(val === 'Online') { exe.status = 'Online'; exe.links[0].statusText = "Global: Online"; exe.links[1].statusText = "VNG: Online"; }
                else if(val === 'Offline') { exe.status = 'Offline'; exe.links[0].statusText = "Global: Offline"; exe.links[1].statusText = "VNG: Offline"; }
                else if(val === 'Partial_GOn') { exe.status = 'Partial'; exe.links[0].statusText = "Global: Online"; exe.links[1].statusText = "VNG: Offline"; }
                else if(val === 'Partial_VOn') { exe.status = 'Partial'; exe.links[0].statusText = "Global: Offline"; exe.links[1].statusText = "VNG: Online"; }
            }
        }

        // --- VIEW: TH√äM M·ªöI ---
        function renderAddView(container) {
            container.innerHTML = `
                <div class="card">
                    <div class="form-group"><label>T√™n Executor:</label><input type="text" id="add-name" class="form-control" placeholder="VD: Delta"></div>
                    <div class="form-group"><label>Link Global (B·∫Øt bu·ªôc):</label><input type="text" id="add-lg" class="form-control" placeholder="https://..."></div>
                    <div class="form-group"><label>Link VNG (Kh√¥ng b·∫Øt bu·ªôc):</label><input type="text" id="add-lv" class="form-control" placeholder="B·ªè tr·ªëng n·∫øu kh√¥ng c√≥"></div>
                    <div class="form-group"><label>Version:</label><input type="text" id="add-ver" class="form-control" placeholder="VD: 2.700"></div>
                    <div class="form-group"><label>Link ·∫¢nh Logo:</label><input type="text" id="add-logo" class="form-control" placeholder="https://..."></div>
                    <div class="form-group">
                        <label>Ch·ªçn Thi·∫øt B·ªã (Device):</label>
                        <select id="add-platform" class="form-control">
                            <option value="pc">PC</option><option value="android">Android</option><option value="ios">iOS</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="executeAdd()">+ Th√™m v√†o danh s√°ch t·∫°m</button>
                </div>
            `;
        }

        function executeAdd() {
            const name = document.getElementById('add-name').value;
            const lg = document.getElementById('add-lg').value;
            const lv = document.getElementById('add-lv').value;
            const ver = document.getElementById('add-ver').value;
            const logo = document.getElementById('add-logo').value;
            const plat = document.getElementById('add-platform').value;

            if(!name || !lg || !ver || !logo) return alert("Vui l√≤ng ƒëi·ªÅn ƒë·ªß c√°c √¥ b·∫Øt bu·ªôc!");

            let links = [];
            if(lv.trim() !== "") {
                links.push({ text: "Global", url: lg, className: "btn-download-main", statusText: "Global: Online" });
                links.push({ text: "VNG", url: lv, className: "btn-download-alt", statusText: "VNG: Online" });
            } else {
                links.push({ text: "Download", url: lg, className: "btn-download-main", statusText: "Status: Online" });
            }

            const newExe = { name, logo, version: ver, status: "Online", links };
            DATA[plat].push(newExe);
            alert("ƒê√£ th√™m " + name + " v√†o danh s√°ch t·∫°m c·ªßa " + plat.toUpperCase());
            switchView('edit', plat);
        }

        // --- VIEW: X√ìA ---
        function renderDeleteView(container) {
            ['pc', 'android', 'ios'].forEach(plat => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<div class="card-title">${plat.toUpperCase()}</div>`;
                DATA[plat].forEach((exe, idx) => {
                    const item = document.createElement('div');
                    item.className = 'delete-item';
                    item.innerHTML = `<span>${exe.name} (v${exe.version})</span>
                                      <button class="btn btn-danger" onclick="executeDelete('${plat}', ${idx})">X√≥a</button>`;
                    card.appendChild(item);
                });
                container.appendChild(card);
            });
        }

        function executeDelete(plat, idx) {
            if(confirm("X√≥a " + DATA[plat][idx].name + "?")) {
                DATA[plat].splice(idx, 1);
                render();
            }
        }

        // --- L∆ØU L√äN GITHUB ---
        function generateJSString(data) {
            const formatLinks = links => links.map(l => 
                `{ text: "${l.text}", url: "${l.url}", className: "${l.className}"${l.statusText ? `, statusText: "${l.statusText}"` : ''} }`
            ).join(',\n                    ');
            
            const platforms = Object.keys(data).map(p => {
                const exes = data[p].map(e => 
                    `            {
                name: "${e.name}", logo: "${e.logo}", version: "${e.version}", status: "${e.status}",
                links: [
                    ${formatLinks(e.links)}
                ]
            }`
                ).join(',\n');
                return `        ${p}: [\n${exes}\n        ]`;
            }).join(',\n');
            return `const EXECUTOR_DATA = {\n${platforms}\n    };`;
        }

        async function saveToGithub() {
            const btn = document.getElementById('save-btn');
            if(!confirm("ƒê·∫©y t·∫•t c·∫£ thay ƒë·ªïi (S·ª≠a/Th√™m/X√≥a) l√™n GitHub?")) return;

            btn.innerHTML = '<i class="fas fa-spinner loading-spin"></i>';
            const newDataString = generateJSString(DATA);
            
            try {
                // T·∫£i file g·ªëc ƒë·ªÉ gi·ªØ nguy√™n ph·∫ßn code bao quanh (n·∫øu c√≥)
                const resRaw = await fetch('https://raw.githubusercontent.com/ugphone839/Executors/refs/heads/main/script.js?t=' + Date.now());
                const originalText = await resRaw.text();
                const finalContent = originalText.replace(/const EXECUTOR_DATA = {[\s\S]*?};/, newDataString);

                const res = await fetch('/api/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: finalContent, password: PASSWORD })
                });

                const result = await res.json();
                if (res.ok) alert("‚úÖ " + result.message);
                else alert("‚ùå " + result.message);
            } catch (e) { alert("‚ùå L·ªói: " + e.message); }
            finally { btn.innerHTML = '<i class="fas fa-check"></i>'; }
        }
    </script>
</body>
</html>
